"use strict";(self.webpackChunk_strapi_admin=self.webpackChunk_strapi_admin||[]).push([[2282],{51509:(ee,B,s)=>{s.r(B),s.d(B,{ProvidersPage:()=>ge,default:()=>rt});var t=s(32735),y=s(5636),d=s(88425),U=s(23973),L=s.n(U),W=s(23940),A=s.n(W),p=s(96709),b=s(28356),E=s(17e3),S=s(27649),R=s(94638),F=s(94745),C=s(76330),O=s(29005),h=s(66735),j=s(3594),D=s(88860),ye=s(3685),be=s(50563),Ee=s(68625),$=s(84968),o=s(5173),c=s(59677);const te={id:(0,c.OB)("PopUpForm.Providers.redirectURL.front-end.label"),defaultMessage:"The redirect URL to your front-end app"},re={id:"http://www.client-app.com",defaultMessage:"http://www.client-app.com"},G={id:(0,c.OB)("PopUpForm.Providers.enabled.description"),defaultMessage:"If disabled, users won't be able to use this provider."},H={id:(0,c.OB)("PopUpForm.Providers.enabled.label"),defaultMessage:"Enable"},ae={id:(0,c.OB)("PopUpForm.Providers.key.label"),defaultMessage:"Client ID"},se={id:(0,c.OB)("PopUpForm.Providers.redirectURL.label"),defaultMessage:"The redirect URL to add in your {provider} application configurations"},w={id:(0,c.OB)("PopUpForm.Providers.key.placeholder"),defaultMessage:"TEXT"},ne={id:(0,c.OB)("PopUpForm.Providers.secret.label"),defaultMessage:"Client Secret"},V={email:{form:[[{intlLabel:H,name:"enabled",type:"bool",description:G,size:6}]],schema:o.Ry().shape({enabled:o.Xg().required(d.translatedErrors.required)})},providers:{form:[[{intlLabel:H,name:"enabled",type:"bool",description:G,size:6,validations:{required:!0}}],[{intlLabel:ae,name:"key",type:"text",placeholder:w,size:12,validations:{required:!0}}],[{intlLabel:ne,name:"secret",type:"text",placeholder:w,size:12,validations:{required:!0}}],[{intlLabel:te,placeholder:re,name:"callback",type:"text",size:12,validations:{required:!0}}],[{intlLabel:se,name:"noName",type:"text",validations:{},size:12,disabled:!0}]],schema:o.Ry().shape({enabled:o.Xg().required(d.translatedErrors.required),key:o.Z_().when("enabled",{is:!0,then:o.Z_().required(d.translatedErrors.required),otherwise:o.Z_()}),secret:o.Z_().when("enabled",{is:!0,then:o.Z_().required(d.translatedErrors.required),otherwise:o.Z_()}),callback:o.Z_().when("enabled",{is:!0,then:o.Z_().required(d.translatedErrors.required),otherwise:o.Z_()})})},providersWithSubdomain:{form:[[{intlLabel:H,name:"enabled",type:"bool",description:G,size:6,validations:{required:!0}}],[{intlLabel:ae,name:"key",type:"text",placeholder:w,size:12,validations:{required:!0}}],[{intlLabel:ne,name:"secret",type:"text",placeholder:w,size:12,validations:{required:!0}}],[{intlLabel:{id:(0,c.OB)("PopUpForm.Providers.subdomain.label"),defaultMessage:"Host URI (Subdomain)"},name:"subdomain",type:"text",placeholder:{id:(0,c.OB)("PopUpForm.Providers.subdomain.placeholder"),defaultMessage:"my.subdomain.com"},size:12,validations:{required:!0}}],[{intlLabel:te,placeholder:re,name:"callback",type:"text",size:12,validations:{required:!0}}],[{intlLabel:se,name:"noName",type:"text",validations:{},size:12,disabled:!0}]],schema:o.Ry().shape({enabled:o.Xg().required(d.translatedErrors.required),key:o.Z_().when("enabled",{is:!0,then:o.Z_().required(d.translatedErrors.required),otherwise:o.Z_()}),secret:o.Z_().when("enabled",{is:!0,then:o.Z_().required(d.translatedErrors.required),otherwise:o.Z_()}),subdomain:o.Z_().when("enabled",{is:!0,then:o.Z_().required(d.translatedErrors.required),otherwise:o.Z_()}),callback:o.Z_().when("enabled",{is:!0,then:o.Z_().required(d.translatedErrors.required),otherwise:o.Z_()})})}};var Oe=(r,e,a)=>new Promise((v,u)=>{var P=i=>{try{f(a.next(i))}catch(l){u(l)}},m=i=>{try{f(a.throw(i))}catch(l){u(l)}},f=i=>i.done?v(i.value):Promise.resolve(i.value).then(P,m);f((a=a.apply(r,e)).next())});const Me=r=>Oe(void 0,null,function*(){try{const{data:e}=yield c.be.get((0,c.Gc)("providers"));return e}catch(e){throw r({type:"warning",message:{id:"notification.error"}}),new Error("error")}}),Te=r=>c.be.put((0,c.Gc)("providers"),r);var Re=s(92891);const Le=r=>(0,Re.sortBy)(Object.keys(r).reduce((e,a)=>{const{icon:v,enabled:u,subdomain:P}=r[a],m=v==="envelope"?["fas","envelope"]:["fab",v];return P!==void 0?e.push({name:a,icon:m,enabled:u,subdomain:P}):e.push({name:a,icon:m,enabled:u}),e},[]),"name");var oe=s(88369),le=s(41415),Ce=s(27677),ie=s(11299),Ze=s(15335),Be=s(5803),Se=s(85025),Fe=s(55225),Ie=s(31600),Ue=s(11406),Ae=s(60216),n=s.n(Ae),je=s(83281),De=s(9139),xe=s(10369),we=Object.defineProperty,de=Object.getOwnPropertySymbols,Ne=Object.prototype.hasOwnProperty,ze=Object.prototype.propertyIsEnumerable,ue=(r,e,a)=>e in r?we(r,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[e]=a,X=(r,e)=>{for(var a in e||(e={}))Ne.call(e,a)&&ue(r,a,e[a]);if(de)for(var a of de(e))ze.call(e,a)&&ue(r,a,e[a]);return r};const K=({description:r,disabled:e,intlLabel:a,error:v,name:u,onChange:P,placeholder:m,providerToEditName:f,type:i,value:l})=>{const{formatMessage:M}=(0,y.useIntl)(),Z=u==="noName"?`${strapi.backendURL}/api/connect/${f}/callback`:l,I=M({id:a.id,defaultMessage:a.defaultMessage},X({provider:f},a.values)),T=r?M({id:r.id,defaultMessage:r.defaultMessage},X({provider:f},r.values)):"";if(i==="bool")return t.createElement(De.s,{"aria-label":u,checked:l,disabled:e,hint:T,label:I,name:u,offLabel:M({id:"app.components.ToggleCheckbox.off-label",defaultMessage:"Off"}),onLabel:M({id:"app.components.ToggleCheckbox.on-label",defaultMessage:"On"}),onChange:x=>{P({target:{name:u,value:x.target.checked}})}});const Y=m?M({id:m.id,defaultMessage:m.defaultMessage},X({},m.values)):"",J=v?M({id:v,defaultMessage:v}):"";return t.createElement(xe.o,{"aria-label":u,disabled:e,error:J,label:I,name:u,onChange:P,placeholder:Y,type:i,value:Z})};K.defaultProps={description:null,disabled:!1,error:"",placeholder:null,value:""},K.propTypes={description:n().shape({id:n().string.isRequired,defaultMessage:n().string.isRequired,values:n().object}),disabled:n().bool,error:n().string,intlLabel:n().shape({id:n().string.isRequired,defaultMessage:n().string.isRequired,values:n().object}).isRequired,name:n().string.isRequired,onChange:n().func.isRequired,placeholder:n().shape({id:n().string.isRequired,defaultMessage:n().string.isRequired,values:n().object}),providerToEditName:n().string.isRequired,type:n().string.isRequired,value:n().oneOfType([n().bool,n().string])};const We=K;var $e=Object.defineProperty,Ge=Object.defineProperties,He=Object.getOwnPropertyDescriptors,ce=Object.getOwnPropertySymbols,Ve=Object.prototype.hasOwnProperty,Xe=Object.prototype.propertyIsEnumerable,me=(r,e,a)=>e in r?$e(r,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[e]=a,Ke=(r,e)=>{for(var a in e||(e={}))Ve.call(e,a)&&me(r,a,e[a]);if(ce)for(var a of ce(e))Xe.call(e,a)&&me(r,a,e[a]);return r},qe=(r,e)=>Ge(r,He(e));const q=({headerBreadcrumbs:r,initialData:e,isSubmiting:a,layout:v,isOpen:u,onSubmit:P,onToggle:m,providerToEditName:f})=>{const{formatMessage:i}=(0,y.useIntl)();return u?t.createElement(Se.P,{onClose:m,labelledBy:"title"},t.createElement(Fe.x,null,t.createElement(ie.O,{label:r.join(", ")},r.map(l=>t.createElement(ie.$,{key:l},l)))),t.createElement(je.Formik,{onSubmit:l=>P(l),initialValues:e,validationSchema:v.schema,validateOnChange:!1},({errors:l,handleChange:M,values:Z})=>t.createElement(d.Form,null,t.createElement(Ie.f,null,t.createElement(Ce.K,{spacing:1},t.createElement(Ze.r,{gap:5},v.form.map(I=>I.map(T=>t.createElement(Be.P,{key:T.name,col:T.size,xs:12},t.createElement(We,qe(Ke({},T),{error:l[T.name],onChange:M,value:Z[T.name],providerToEditName:f})))))))),t.createElement(Ue.m,{startActions:t.createElement(le.z,{variant:"tertiary",onClick:m,type:"button"},i({id:"app.components.Button.cancel",defaultMessage:"Cancel"})),endActions:t.createElement(le.z,{type:"submit",loading:a},i({id:"global.save",defaultMessage:"Save"}))})))):null};q.defaultProps={initialData:null,providerToEditName:null},q.propTypes={headerBreadcrumbs:n().arrayOf(n().string).isRequired,initialData:n().object,layout:n().shape({form:n().arrayOf(n().array),schema:n().object}).isRequired,isOpen:n().bool.isRequired,isSubmiting:n().bool.isRequired,onSubmit:n().func.isRequired,onToggle:n().func.isRequired,providerToEditName:n().string};const Qe=q;var Ye=Object.defineProperty,Je=Object.defineProperties,ke=Object.getOwnPropertyDescriptors,pe=Object.getOwnPropertySymbols,_e=Object.prototype.hasOwnProperty,et=Object.prototype.propertyIsEnumerable,ve=(r,e,a)=>e in r?Ye(r,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[e]=a,Q=(r,e)=>{for(var a in e||(e={}))_e.call(e,a)&&ve(r,a,e[a]);if(pe)for(var a of pe(e))et.call(e,a)&&ve(r,a,e[a]);return r},tt=(r,e)=>Je(r,ke(e)),fe=(r,e,a)=>new Promise((v,u)=>{var P=i=>{try{f(a.next(i))}catch(l){u(l)}},m=i=>{try{f(a.throw(i))}catch(l){u(l)}},f=i=>i.done?v(i.value):Promise.resolve(i.value).then(P,m);f((a=a.apply(r,e)).next())});const ge=()=>{const{formatMessage:r}=(0,y.useIntl)();(0,d.useFocusWhenNavigate)();const{notifyStatus:e}=(0,R.G)(),a=(0,$.useQueryClient)(),{trackUsage:v}=(0,d.useTracking)(),u=(0,t.useRef)(v),[P,m]=(0,t.useState)(!1),[f,i]=(0,t.useState)(!1),[l,M]=(0,t.useState)(null),Z=(0,d.useNotification)(),{lockApp:I,unlockApp:T}=(0,d.useOverlayBlocker)(),Y=(0,t.useMemo)(()=>({update:oe.Z.updateProviders}),[]),{isLoading:J,allowedActions:{canUpdate:x}}=(0,d.useRBAC)(Y),{isLoading:at,data:N,isFetching:st}=(0,$.useQuery)("get-providers",()=>Me(Z),{onSuccess(){e(r({id:(0,c.OB)("Providers.data.loaded"),defaultMessage:"Providers have been loaded"}))},initialData:{}}),nt=at||st,ot=(0,$.useMutation)(Te,{onSuccess(){return fe(this,null,function*(){yield a.invalidateQueries("get-providers"),Z({type:"info",message:{id:(0,c.OB)("notification.success.submit")}}),u.current("didEditAuthenticationProvider"),i(!1),k(),T()})},onError(){Z({type:"warning",message:{id:"notification.error"}}),T(),i(!1)},refetchActive:!1}),z=(0,t.useMemo)(()=>Le(N),[N]),lt=z.length,he=(0,t.useMemo)(()=>{if(!l)return!1;const g=z.find(_=>_.name===l);return L()(g,"subdomain")},[z,l]),it=r({id:(0,c.OB)("HeaderNav.link.providers"),defaultMessage:"Providers"}),dt=(0,t.useMemo)(()=>l==="email"?V.email:he?V.providersWithSubdomain:V.providers,[l,he]),k=()=>{m(g=>!g)},Pe=g=>{x&&(M(g.name),k())},ut=g=>fe(void 0,null,function*(){i(!0),I(),u.current("willEditAuthenticationProvider");const _=tt(Q({},N),{[l]:g});ot.mutate({providers:_})});return t.createElement(p.A,null,t.createElement(d.SettingsPageTitle,{name:it}),t.createElement(S.o,null,t.createElement(b.T,{title:r({id:(0,c.OB)("HeaderNav.link.providers"),defaultMessage:"Providers"})}),nt||J?t.createElement(d.LoadingIndicatorPage,null):t.createElement(E.D,null,t.createElement(F.i,{colCount:3,rowCount:lt+1},t.createElement(C.h,null,t.createElement(O.Tr,null,t.createElement(h.Th,null,t.createElement(D.Z,{variant:"sigma",textColor:"neutral600"},r({id:"global.name",defaultMessage:"Name"}))),t.createElement(h.Th,null,t.createElement(D.Z,{variant:"sigma",textColor:"neutral600"},r({id:(0,c.OB)("Providers.status"),defaultMessage:"Status"}))),t.createElement(h.Th,null,t.createElement(D.Z,{variant:"sigma"},t.createElement(ye.T,null,r({id:"global.settings",defaultMessage:"Settings"})))))),t.createElement(j.p,null,z.map(g=>t.createElement(O.Tr,Q({key:g.name},(0,d.onRowClick)({fn:()=>Pe(g),condition:x})),t.createElement(h.Td,{width:"45%"},t.createElement(D.Z,{fontWeight:"semiBold",textColor:"neutral800"},g.name)),t.createElement(h.Td,{width:"65%"},t.createElement(D.Z,{textColor:g.enabled?"success600":"danger600","data-testid":`enable-${g.name}`},g.enabled?r({id:"global.enabled",defaultMessage:"Enabled"}):r({id:"global.disabled",defaultMessage:"Disabled"}))),t.createElement(h.Td,Q({},d.stopPropagation),x&&t.createElement(be.h,{onClick:()=>Pe(g),noBorder:!0,icon:t.createElement(Ee.Z,null),label:"Edit"})))))))),t.createElement(Qe,{initialData:N[l],isOpen:P,isSubmiting:f,layout:dt,headerBreadcrumbs:[r({id:(0,c.OB)("PopUpForm.header.edit.providers"),defaultMessage:"Edit Provider"}),A()(l)],onToggle:k,onSubmit:ut,providerToEditName:l}))},rt=()=>t.createElement(d.CheckPagePermissions,{permissions:oe.Z.readProviders},t.createElement(ge,null))},8917:(ee,B,s)=>{s.d(B,{Z:()=>A});var t=s(71112),y=s(88425),d=s.n(y),U=(p,b,E)=>new Promise((S,R)=>{var F=h=>{try{O(E.next(h))}catch(j){R(j)}},C=h=>{try{O(E.throw(h))}catch(j){R(j)}},O=h=>h.done?S(h.value):Promise.resolve(h.value).then(F,C);O((E=E.apply(p,b)).next())});const L=t.Z.create({baseURL:"http://localhost:1337"});L.interceptors.request.use(p=>U(void 0,null,function*(){return p.headers={Authorization:`Bearer ${y.auth.getToken()}`,Accept:"application/json","Content-Type":"application/json"},p}),p=>{Promise.reject(p)}),L.interceptors.response.use(p=>p,p=>{var b;throw((b=p.response)==null?void 0:b.status)===401&&(y.auth.clearAppStorage(),window.location.reload()),p});const A=(0,y.wrapAxiosInstance)(L)},59677:(ee,B,s)=>{s.d(B,{be:()=>t.Z,YX:()=>U,Gc:()=>A,OB:()=>p.Z});var t=s(8917),y=s(92891);const U=b=>Object.keys(b).reduce((E,S)=>{const R=b[S].controllers,F=Object.keys(R).reduce((C,O)=>((0,y.isEmpty)(R[O])||(C[O]=R[O]),C),{});return(0,y.isEmpty)(F)||(E[S]={controllers:F}),E},{});var L=s(90201);const A=b=>`/${L.Z}/${b}`;var p=s(82069)}}]);
