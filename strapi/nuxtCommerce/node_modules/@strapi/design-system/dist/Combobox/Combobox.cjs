"use strict";var qe=Object.defineProperty,ke=Object.defineProperties;var je=Object.getOwnPropertyDescriptors;var j=Object.getOwnPropertySymbols;var Q=Object.prototype.hasOwnProperty,X=Object.prototype.propertyIsEnumerable;var J=(e,s,r)=>s in e?qe(e,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[s]=r,w=(e,s)=>{for(var r in s||(s={}))Q.call(s,r)&&J(e,r,s[r]);if(j)for(var r of j(s))X.call(s,r)&&J(e,r,s[r]);return e},A=(e,s)=>ke(e,je(s));var Y=(e,s)=>{var r={};for(var f in e)Q.call(e,f)&&s.indexOf(f)<0&&(r[f]=e[f]);if(e!=null&&j)for(var f of j(e))s.indexOf(f)<0&&X.call(e,f)&&(r[f]=e[f]);return r};Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const l=require("react"),Me=require("prop-types"),Oe=require("@strapi/icons/CarretDown"),Le=require("@strapi/icons/Cross"),Se=require("../helpers/useId.cjs"),c=require("./utils.cjs"),Z=require("../Flex/Flex.cjs"),ee=require("../Select/components.cjs"),Re=require("../Popover/Popover.cjs"),we=require("../Box/Box.cjs"),te=require("../Typography/Typography.cjs"),Ae=require("../Loader/Loader.cjs"),M=require("./components.cjs"),Te=require("./ComboboxOption.cjs"),$e=require("./ComboboxList.cjs"),Be=require("../Field/Field.cjs"),De=require("../Field/FieldLabel.cjs");require("../Field/FieldInput.cjs");const Pe=require("../Field/FieldHint.cjs"),_e=require("../Field/FieldError.cjs");require("../Field/FieldContext.cjs");require("../Field/FieldAction.cjs");const Ve=require("../Stack/Stack.cjs"),Ke=require("../helpers/keyboardKeys.cjs"),He=require("../VisuallyHidden/VisuallyHidden.cjs"),O=e=>e&&typeof e=="object"&&"default"in e?e:{default:e},n=O(l),t=O(Me),Ne=O(Oe),Ue=O(Le),F=ze=>{var V=ze,{children:e,clearLabel:s,creatable:r,createMessage:f,disabled:m,error:L,hasMoreItems:oe,hint:$,label:h,labelAction:ne,loading:S,loadingMessage:ae,noOptionsMessage:re,onChange:B,onClear:D,onCreateOption:le,onInputChange:P,onLoadMore:se,placeholder:ie,required:_,value:C}=V,ce=Y(V,["children","clearLabel","creatable","createMessage","disabled","error","hasMoreItems","hint","label","labelAction","loading","loadingMessage","noOptionsMessage","onChange","onClear","onCreateOption","onInputChange","onLoadMore","placeholder","required","value"]);const ue=()=>{var o;return(o=e.find(a=>{var i;return((i=a.props)==null?void 0:i.value.toLowerCase())===C.toLowerCase()}).props)==null?void 0:o.children},[d,K]=l.useState(0),[de,fe]=l.useState(null),[b,H]=l.useState(e),[x,pe]=l.useState(!1),[u,q]=l.useState(""),v=l.useRef(),k=l.useRef(!1),I=l.useRef(),N=l.useRef(),be=l.useRef(),U=l.useRef(!0),p=Se.useId("combobox"),z=`${p}-label`;if(!h&&!ce["aria-label"])throw new Error('The Combobox component needs a "label" or an "aria-label" props');l.useEffect(()=>{H(c.filterOptions(e,u))},[u,e]),l.useEffect(()=>{x&&v.current&&c.maintainScrollVisibility(v.current)},[d,x]),l.useLayoutEffect(()=>{U.current&&(U.current=!1)},[C]);const me=x?`${p}-${d}`:"",W=()=>{B(null),q("")},Ce=o=>{P&&P(o);const a=I.current.value;H(c.filterOptions(e,a)),K(0),fe(null),u!==a&&q(a),x||g(!0,!1)},ge=o=>{const{key:a}=o,i=r&&u?b.length:b.length-1,E=c.getActionFromKey(a,x);switch(C&&!u&&a===Ke.KeyboardKeys.BACKSPACE&&W(),E){case c.MenuActions.Next:{if(d===i){y(0);break}y(c.getUpdatedIndex(d,i,E));break}case c.MenuActions.Previous:{if(d===0){y(i);break}y(c.getUpdatedIndex(d,i,E));break}case c.MenuActions.Last:case c.MenuActions.First:{if(d===i){y(0);break}y(c.getUpdatedIndex(d,i,E));break}case c.MenuActions.CloseSelect:o.preventDefault(),R(d);break;case c.MenuActions.Close:o.preventDefault(),g(!1);break;case c.MenuActions.Open:g(!0);break}},xe=o=>{if(o.preventDefault(),C&&!k.current&&q(""),k.current){k.current=!1;return}g(!1,!1)},y=o=>{K(o)},ye=o=>{y(o),R(o)},G=()=>{k.current=!0},R=o=>{const a=b[o];if(q(""),a){B(a.props.value),g(!1);return}r&&(le(u),g(!1))},g=(o,a=!0)=>{pe(o),a&&I.current.focus()},he=l.Children.toArray(b).map((o,a)=>{const i=d===a;return l.cloneElement(o,{id:`${p}-${a}`,"aria-selected":de===a,"aria-posinset":a+1,"aria-setsize":l.Children.toArray(b).length,ref(E){i&&(v.current=E)},onClick:()=>ye(a),onMouseDown:G,isSelected:i})}),ve=()=>{I.current.focus(),D&&D(),W()},Ee=()=>{I.current.focus(),g(!0)},Fe=()=>{const o=b.findIndex(a=>{var i;return((i=a.props)==null?void 0:i.children)===u});return u&&o===-1},Ie=o=>{o.preventDefault(),g(o,!0)};return n.default.createElement(Be.Field,{hint:$,error:L,id:p,required:_},n.default.createElement(He.VisuallyHidden,{"aria-live":"polite","aria-atomic":"false","aria-relevant":"additions text"},C),n.default.createElement(Ve.Stack,{spacing:h||$||L?1:0},h&&n.default.createElement(De.FieldLabel,{action:ne},h),n.default.createElement(M.MainRow,{ref:N,$disabled:m,hasError:L},n.default.createElement(M.InputContainer,{wrap:"wrap"},!u&&C&&n.default.createElement(M.ValueContainer,{id:`${p}-selected-value`},n.default.createElement(te.Typography,null,ue())),n.default.createElement(M.Input,{"aria-activedescendant":me,"aria-autocomplete":"list","aria-controls":`${p}-listbox`,"aria-disabled":m,"aria-expanded":x,"aria-haspopup":"listbox","aria-labelledby":h?z:void 0,autoComplete:"off",autoCorrect:"off",id:p,onBlur:m?void 0:xe,onClick:m?void 0:Ie,onInput:m?void 0:Ce,onKeyDown:m?void 0:ge,placeholder:C?"":ie,readOnly:m,ref:I,required:_,role:"combobox",spellCheck:"off",type:"text",value:u})),n.default.createElement(Z.Flex,null,(C||u)&&n.default.createElement(ee.IconBox,{id:`${p}-clear`,"aria-label":s,disabled:m,paddingLeft:3,as:"button",onClick:ve,type:"button"},n.default.createElement(Ue.default,null)),n.default.createElement(ee.CaretBox,{disabled:m,paddingLeft:3,"aria-hidden":!0,as:"button",onClick:Ee,tabIndex:-1,type:"button"},n.default.createElement(Ne.default,null)))),n.default.createElement(Pe.FieldHint,null),n.default.createElement(_e.FieldError,null)),x&&n.default.createElement(Re.Popover,{id:`${p}-popover`,source:N,spacing:4,fullWidth:!0,intersectionId:`${p}-listbox-popover-intersection`,onReachEnd:oe&&!S?se:void 0},n.default.createElement("div",{role:"listbox",ref:be,id:`${p}-listbox`,"aria-labelledby":h?z:void 0},(Boolean(b.length)||r)&&n.default.createElement(n.default.Fragment,null,n.default.createElement($e.ComboboxList,{activeOptionRef:v,options:he}),Fe()&&r&&n.default.createElement(Te.ComboboxOption,{isSelected:d===b.length,ref:o=>{d===b.length&&(v.current=o)},onMouseDown:G,onClick:()=>R(),taindex:0},f(u))),!b.length&&!r&&!S&&n.default.createElement(we.Box,{paddingLeft:4,paddingRight:4,paddingTop:2,paddingBottom:2,ref:v},n.default.createElement(te.Typography,{textColor:"neutral800"},re(u))),S&&n.default.createElement(Z.Flex,{justifyContent:"center",alignItems:"center",paddingTop:2,paddingBottom:2},n.default.createElement(Ae.Loader,{small:!0},ae)))))},T=e=>n.default.createElement(F,A(w({},e),{creatable:!0}));F.defaultProps={"aria-label":void 0,clearLabel:"clear",creatable:!1,createMessage:e=>`Create "${e}"`,disabled:!1,error:void 0,hasMoreItems:!1,hint:void 0,label:void 0,loading:!1,loadingMessage:"Loading content...",noOptionsMessage:()=>"No results found",onClear:void 0,onCreateOption:void 0,onInputChange:void 0,onLoadMore:void 0,placeholder:"Select or enter a value",value:void 0};T.defaultProps=F.defaultProps;F.propTypes={"aria-label":t.default.string,children:t.default.oneOfType([t.default.arrayOf(t.default.node),t.default.node]),clearLabel:t.default.string,creatable:t.default.bool,createMessage:t.default.func,disabled:t.default.bool,error:t.default.string,hasMoreItems:t.default.bool,hint:t.default.oneOfType([t.default.string,t.default.node,t.default.arrayOf(t.default.node)]),label:t.default.string,labelAction:t.default.element,loading:t.default.bool,loadingMessage:t.default.string,noOptionsMessage:t.default.func,onChange:t.default.func.isRequired,onClear:t.default.func,onCreateOption:t.default.func,onInputChange:t.default.func,onLoadMore:t.default.func,placeholder:t.default.string,value:t.default.string};T.propTypes=A(w({},F.propTypes),{onCreateOption:t.default.func.isRequired});exports.Combobox=F;exports.CreatableCombobox=T;
